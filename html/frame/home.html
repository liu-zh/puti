<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>首页-frame</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/swiper.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/home.css"/>
      <script type="text/javascript" src="../../script/jquery.min.js"></script>
      <script type="text/javascript" src="../../script/jquery.arctext.js"></script>
      <style>
        .alert{
          font-size: 0.55rem;
          text-align: center;
          height: 1.5rem;
          line-height: 1.5rem;
        }
      </style>
  </head>
  <body>
    <section id="app">
      <div class="snowbg"></div>
      <section class="swiper swiper-container1" @click="openWin('product', false)" id="swiper1">
        <div class="swiper-wrapper">
          <div class="swiper-slide" v-for="item in allData.advert">
            <img :src="'http://puti.maiyatang.info' + item.nvaimage" class="swiper-lazy">
          </div>
        </div>
      </section>
      <!-- 中间导航栏 -->
      <section class="aui-grid">
        <div class="aui-row">
          <div class="aui-col-xs-3" onclick="openWin('product', false)" tapmode>
              <img src="../../image/home/chanpin.png">
              <div class="aui-grid-label">产品</div>
          </div>
          <div class="aui-col-xs-3" @click="openWin('chanbu', true, {num: steps, number: num})" tapmode>
              <img src="../../image/home/chanbu.png">
              <div class="aui-grid-label">禅步</div>
          </div>
          <div class="aui-col-xs-3" @click="openWin('shangxueyuan', false, {data: allData.college})" tapmode>
              <img src="../../image/home/shangxueyuan.png">
              <div class="aui-grid-label">商学院</div>
          </div>
          <div class="aui-col-xs-3" onclick="openWin('invite_friends', true)">
              <img src="../../image/home/yaoqing.png">
              <div class="aui-grid-label">邀请</div>
          </div>
          <div class="aui-col-xs-3" onclick="openWin('activity', true)" tapmode>
              <img src="../../image/home/ruzhu.png">
              <div class="aui-grid-label">活动</div>
          </div>
          <div class="aui-col-xs-3" onclick="openWin('fangshengchi', true)" tapmode>
              <img src="../../image/home/gongdewuliang.png">
              <div class="aui-grid-label">放生池</div>
          </div>
          <div class="aui-col-xs-3" onclick="openWin('sign_in', true)" tapmode>
              <img src="../../image/home/qiandao.png">
              <div class="aui-grid-label">签到</div>
          </div>
          <div class="aui-col-xs-3" onclick="openWin('choujiang', true)" tapmode>
              <img src="../../image/home/choujiang.png">
              <div class="aui-grid-label">抽奖</div>
          </div>
        </div>
      </section>
      <!-- 佛语公告 -->
      <section id="notice" >
          <div style="margin-right: 0.5rem;">禅语:</div>
          <div class="swiper swiper-container2">
            <div class="swiper-wrapper">
              <div class="swiper-slide" v-for="it in cache" @click="openWin('notice', false, {data: it, type: 0})">
                <span v-text="it.title"></span>
              </div>
            </div>
          </div>
      </section>
      <!-- 保湿喷雾那一块 -->
      <div class="guanggao" onclick="openWin('product', false)">
        <div class="top">
          <div class="guanggao-top-left">
            <span></span>
            <span></span>
          </div>
          <div class="guanggao-top-middle">
            <img src="../../image/home/dingwei.png">
            <span>保湿喷雾</span>
          </div>
          <div class="guanggao-top-right">
            <span></span>
            <span></span>
          </div>
        </div>
        <div class="bottom">
          <div class="left">
            <div id="round">#每周玩转你的梳妆台#</div>
            <div class="new">新品聚惠</div>
            <div class="details">保湿，滋润，舒缓肌肤，成分天然温和不添加刺激成分，雾化细腻不化妆敏感也可以使用</div>
            <div class="qianggou">
              <div>低至<span v-text="product.price"></span>元  立即抢购 ></div>
            </div>
          </div>
          <div class="right">
            <img src="../../image/home/penwu1.png">
            <img src="../../image/home/penwu2.png">
            <img src="../../image/home/penwu3.png">
            <img src="../../image/home/penwu1.png">
          </div>
        </div>
      </div>
      <!-- 倒计时 -->
      <div class="daojishi" onclick="openWin('product', false)">
        <div>距活动结束还有</div>
        <div>{{time.day}}天{{time.hour}}时{{time.minute}}分{{time.second}}秒</div>
      </div>
      <!-- 计步器 -->
      <div class="jibuqi">
        <div class="jibuqi_top" onclick="openWin('chanbu', true, {num: steps, number: num})">
          <div class="jibuqi-top-left">
            <span></span>
            <span></span>
          </div>
          <div class="jibuqi-top-middle">
            <span>每日禅步</span>
          </div>
          <div class="jibuqi-top-right">
            <span></span>
            <span></span>
          </div>
        </div>
        <div class="jibuqi_bottom">
          <div class="jibuqi_bottom_left">
            <img :src="chanbu_imgpath" id="run">
          </div>
          <div class="jibuqi_bottom_right">
            <p>今日步数</p>
            <p v-if="!token" class="steps">0</p>
            <p class="steps" v-else>{{steps}}</p>
            <div class="jibuqi_box">
              <div class="round">
                <div class="round1">
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              			<div><span></span></div>
              	</div>
              </div>
              <div class="button"><div @click="duihuan()">存入余额</div></div>
            </div>
            <div class="num" v-if="token">今日菩提籽奖励 <span v-text="num"></span> 个</div>
            <div class="num" v-if="!token">今日菩提籽奖励 <span>0</span> 个</div>
          </div>
        </div>
      </div>
      <!-- 兑换平台 -->
      <div class="exchange">
        <div class="jibuqi_top">
          <div class="jibuqi-top-left">
            <span></span>
            <span></span>
          </div>
          <div class="jibuqi-top-middle">
            <span>兑换平台</span>
          </div>
          <div class="jibuqi-top-right">
            <span></span>
            <span></span>
          </div>
        </div>
        <ul class="chat-list">
          <li>
            <span>用户名</span>
            <span>菩提籽</span>
            <span>沟通</span>
            <span>交易状态</span>
          </li>
          <li v-for="item in guamai">
            <span>{{item.mobile.substr(0,3)+ "****" + item.mobile.substr(7)}}</span>
            <span>{{item.num}}</span>
            <span>在线</span>
            <span class="buy" @click="openWin('chat_box', true, {id: item})"><span>聊天</span></span>
          </li>
          <li class="alert" v-if="guamai.length == 0">暂时没有信息</div>
        </ul>
      </div>
      <!-- 商学院 -->
      <section class="business">
        <div class="jibuqi_top" style="height: 2.5rem;">
          <div class="jibuqi-top-left">
            <span></span>
            <span></span>
          </div>
          <div class="jibuqi-top-middle">
            <span>商学院</span>
          </div>
          <div class="jibuqi-top-right">
            <span></span>
            <span></span>
          </div>
        </div>
        <div class="tabbar">
          <div :class="index == item.id ? 'tabbar-box1' : 'tabbar-box'" @click="fojing_tabbar(item.id)" v-for=" item in allData.college">
            <span>{{item.name}}</span>
            <span class="aui-iconfont aui-icon-down" v-if="index != item.id"></span>
            <span class="aui-iconfont aui-icon-top" v-else></span>
          </div>
        </div>
      </section>
      <!-- 商学院相关文章 -->
      <section v-for=" item in shangxueyuan">
        <section class="wenzhang" v-if="index == item.id" v-for="it in item.contents" @click="openWin('shangxueyuan_details', false, {data: it, content: item.name})">
          <div class="wenzhang-box">
            <div class="wenzhang-box-left"><img :src="'http://puti.maiyatang.info' + it.c_image"></div>
            <div class="wenzhang-box-right" v-html="it.c_content"></div>
          </div>
        </section>
      </section>
    </section>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/vue.js"></script>
  <script type="text/javascript" src="../../script/swiper.js"></script>
  <script type="text/javascript" src="../../script/common.js"></script>
  <script type="text/javascript" src="../../script/aui-toast.js"></script>
  <script type="text/javascript" src="../../script/fastclick.js"></script>
  <script type="text/javascript" src="../../script/piaoluo.js"></script>
  <script type="text/javascript">
      var chanbu_timer;
      var chanbu_i = 1;
      FastClick.attach(document.body);
      apiready = function(){
        var toast = new auiToast();
        let vue = new Vue({
          el: "#app",
          data: {
            index: 12,// 商学院切换下标
            time:{day: 0, hour: 0, minute: 0, second: 0}, //倒计时
            steps: 0,// 计步器步数
            steps2: 0, // 上次的步数(本地存储的步数)
            currentdate: null, //当前时间
            currentdate1: null, // 结束计步时间
            daytime: null,// 当天时间
            allData:{},// 主页总数据
            token: $api.getStorage('token'),
            guamai: [], // 存储挂卖数据的数据(显示几条数据, 切割数组)
            num: 0, // 菩提籽数量
            chanbu_imgpath: '../../image/canbu/nan/1.png',//禅步的图片路径
            timeout: 1,
            level:0, //等级
            cache: [], // 佛语
            it: {}, // 佛语
            shangxueyuan: [],//商学院文章
            product:{},//产品信息
          },
          methods: {
            //切换商学院内容
            fojing_tabbar: function(i){
              vue.index = i;
            },
            // 倒计时函数
            countDown: function(times){
              var timer = null;
              timer = setInterval(function() {
      					var day = 0,
      						hour = 0,
      						minute = 0,
      						second = 0; //时间默认值
      					if (times > 0) {
      						day = Math.floor(times / (60 * 60 * 24));
      						hour = Math.floor(times / (60 * 60)) - (day * 24);
      						minute = Math.floor(times / 60) - (day * 24 * 60) - (hour * 60);
      						second = Math.floor(times) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
      					}
      					if (day <= 9) day = '0' + day;
      					if (hour <= 9) hour = '0' + hour;
      					if (minute <= 9) minute = '0' + minute;
      					if (second <= 9) second = '0' + second;
                vue.time.day = day;
                vue.time.hour = hour;
                vue.time.minute = minute;
                vue.time.second = second;
      					times--;
      				}, 1000);
      				if (times <= 0) {
      					clearInterval(timer);
      				}
            },
            // 计步器函数
            step_number: function(){
              var systemType = api.systemType;
              var pedometer = api.require('pedometer');
              var date = new Date();
              var year = date.getFullYear();
              var month = date.getMonth() + 1;
              var day = date.getDate();
              var day1 = date.getDate() - 1;
              var hour = date.getHours();
              var minute = date.getMinutes();
              var second = date.getSeconds();
              var sign1 = "-";
              var sign2 = ":";
              var _this = this;
              this.daytime = year + sign1 + month + sign1 + day;
              this.steps2 = $api.getStorage(this.daytime);
              this.steps2 = parseInt(this.steps2);
              if(!this.steps2){
                this.steps2 = 0;
              }
              this.steps = this.steps2;
                if (systemType == 'android') {
                  pedometer.startCount(function(ret) {
                    if(vue.timeout){
                      vue.timeout = 0;
                      chanbu_timer = setInterval(function(){
                        if (vue.allData.userinfo){
                          if (vue.allData.userinfo.gender == '-1') {
                            vue.chanbu_imgpath = '../../image/canbu/nv/' + chanbu_i + '.png';
                          } else {
                            vue.chanbu_imgpath = '../../image/canbu/nan/' + chanbu_i + '.png';
                          }
                        } else {
                          vue.chanbu_imgpath = '../../image/canbu/nan/' + chanbu_i + '.png';
                        }
                        chanbu_i++;
                        if (chanbu_i > 7) {
                          chanbu_i = 1;
                        }
                      },200);
                    }
                    pedometer.getSteps(function(ret1) {
                      _this.steps = _this.steps2+ret1.steps;
                      $api.setStorage(_this.daytime, _this.steps);
                      // 圆形进度条的样式(总步数暂时为30000)
                      var span = $api.domAll('.round1>div>span');
                      if (_this.steps <= 30000) {
                        for(var i = 0; i < span.length*(_this.steps/30000); i++){
                  				span[i].style.backgroundColor = '#EEBE44';
                  			}
                      } else {
                        for(var i = 0; i < span.length*(30000/30000); i++){
                  				span[i].style.backgroundColor = '#EEBE44';
                  			}
                      }
                      // 监听步数
                      api.sendEvent({
                        name: 'chanbu'
                      });
                      setTimeout(function () {
                        vue.timeout = 1;
                        clearInterval(chanbu_timer)
                      }, 5000);//是否停止走路
                    });
                  });
                } else if(systemType == "ios"){
                  //获取当前时间
                  if (month >= 1 && month <= 9) { month = "0" + month; }
                  if (day >= 0 && day <= 9) { day = "0" + day; }
                  if (hour >= 0 && hour <= 9) { hour = "0" + hour; }
                  if (minute >= 0 && minute <= 9) { minute = "0" + minute; }
                  if (second >= 0 && second <= 9) { second = "0" + second; }
                  // 当前时间
                  var currentdate = year + sign1 + month + sign1 + day + " " + hour + sign2 + minute + sign2 + second;
                  // 结束时间
                  var currentdate1 = year + sign1 + month + sign1 + day1 + " " + '23' + sign2 + '59' + sign2 + '59';
                  // pedometer.getStepCount({
                  //   count: 0,
                  //   startTime: currentdate1,
                  //   endTime: currentdate
                  // }, function(ret) {
                  //     vue.steps = ret.total;
                  //     if(vue.timeout){
                  //       vue.timeout = 0;
                  //       chanbu_timer = setInterval(function(){
                  //         if (vue.allData.userinfo){
                  //           if (vue.allData.userinfo.gender == '-1') {
                  //             vue.chanbu_imgpath = '../../image/canbu/nv/' + chanbu_i + '.png';
                  //           } else {
                  //             vue.chanbu_imgpath = '../../image/canbu/nan/' + chanbu_i + '.png';
                  //           }
                  //         } else {
                  //           vue.chanbu_imgpath = '../../image/canbu/nan/' + chanbu_i + '.png';
                  //         }
                  //         chanbu_i++;
                  //         if (chanbu_i > 7) {
                  //           chanbu_i = 1;
                  //         }
                  //       },200);
                  //     }
                  //     // 圆形进度条的样式(总步数暂时为30000)
                  //     var span = $api.domAll('.round1>div>span');
                  //     if (_this.steps <= 30000) {
                  //       for(var i = 0; i < span.length*(_this.steps/30000); i++){
                  // 				span[i].style.backgroundColor = '#EEBE44';
                  // 			}
                  //     } else {
                  //       for(var i = 0; i < span.length; i++){
                  // 				span[i].style.backgroundColor = '#EEBE44';
                  // 			}
                  //     }
                  //     // 监听步数
                  //     api.sendEvent({
                  //       name: 'chanbu'
                  //     });
                  //     setTimeout(function () {
                  //       vue.timeout = 1;
                  //       clearInterval(chanbu_timer)
                  //     }, 5000);//是否停止走路
                  //});
                }
            },
            // 发起网络请求的函数
            request: function(){
              post('index/index').then(function(res){
                vue.allData = res.data.data;
                vue.guamai = vue.allData.guamai.slice(0, 6);
                vue.shangxueyuan = vue.allData.college.slice(0, 6);
                vue.num = vue.allData.putizi;
                if (vue.allData.userinfo) {
                  if (vue.allData.userinfo.gender == '-1') {
                    vue.chanbu_imgpath = '../../image/canbu/nv/1.png';
                  } else {
                    vue.chanbu_imgpath = '../../image/canbu/nan/1.png';
                  }
                } else {
                  vue.chanbu_imgpath = '../../image/canbu/nan/1.png';
                }
              });
            },
            //兑换禅步
            duihuan: function(){
              if (vue.token) {
                  post('index/exchange', {steps: vue.steps}).then(function(res){
                    vue.num = res.putizi;
                    api.toast({msg: res.msg});
                    api.sendEvent({
                      name: 'userinfo'
                    });
                    piaoluo();
                    setTimeout(function(){
                      clearInterval(timers)
                    },1500);
                  })
              } else {
                openWin('login')
              }
            },
            // 轮播图
            swiper: function(){
              var mySwiper = new Swiper('.swiper-container1', {
                autoplay: true,
                lazy: {loadPrevNext: true},
                loop: true
              });
            },
            // 禅语上下滚动
            swiper1: function(){
              var mySwiper1 = new Swiper('.swiper-container2', {
                autoplay: {
                  delay: 3000,
                },
                loop: true,
                direction: 'vertical',
              });
            },
            // 获取佛语的函数(暂时为通知)
            infrom: function(){
              post('about/lists').then(res=>{
                vue.cache = res.data;
                vue.swiper1();
              })
            },

          },
          mounted: function(){
            // 首页的总网络请求
            this.request();
            // 倒计时函数
            this.countDown(141315);
            // 计步器函数
            this.step_number();
            setTimeout(function(){
              vue.swiper();
              vue.swiper1();
            },1000);
            this.infrom();// 佛语函数
            //获取产品信息
            post('index/details').then(res=> {
              vue.product = res.data;
            });
          }
        });
        setInterval(vue.request(), 30000);
        // 监听是否登录
        api.addEventListener({
          name: 'login'
        }, function(ret, err) {
          vue.token = $api.getStorage("token");
          vue.request();
        });
        // 监听是否退出登录
        api.addEventListener({
          name: 'logout'
        }, function(ret, err) {
          vue.token = $api.getStorage("token");
          vue.request();
        });
        // 监听用户信息是否被修改
        api.addEventListener({
          name: 'userinfo'
        }, function(ret, err) {
          vue.request();
        });
        // 下拉刷新
        api.setCustomRefreshHeaderInfo({
            bgColor: '#E6E7E8',
            image: {
              pull: ['widget://image/icon.png'],
              load: ['widget://image/icon.png']
            }
        }, function() {
            vue.request();
            api.refreshHeaderLoadDone();
        });
        // 圆弧
        var round = $api.domAll('.round1>div');
        for(var i = 0; i < round.length; i++){
  				round[i].style.transform = 'rotateZ('+ i*6 + 'deg)';
  			}
        // 圆形进度条的样式(总步数暂时为30000)
        var span = $api.domAll('.round1>div>span');
        if (vue.steps > 30000) {
          vue.steps = 30000;
        }
        for(var i = 0; i < span.length*(vue.steps/30000); i++){
          span[i].style.backgroundColor = '#EEBE44';
        }

      };
      // 弧形文字
        $(function(){
          $("#round").arctext({
              radius:90
          })
      })
  </script>
  </html>
